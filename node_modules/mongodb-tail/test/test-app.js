
'use strict';

const mongodb = require('mongodb');
const tail = require('../mongodb-tail');

mongodb.connect('mongodb://localhost:27001,localhost:27002/local?replicaSet=rs', (err, db) => {
  if (err) throw err;
  tail(
    db.collection('oplog.rs'),
    (latest) => ({ ts: { $gt: latest.ts }, fromMigrate: { $exists: false }, ns: 'test.test', op: { $in: ['i', 'u', 'd'] } })
  )
    .on('error', (err) => console.error(err))
    .on('next', (item) => console.log(item.ts));
  process.on('SIGINT', () => {
    db.close();
    console.log('exit');
    process.exit(0);
  });
  console.log('running');
});
